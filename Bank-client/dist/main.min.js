var Configuration=Backbone.Model.extend({apiEndPoint:"http://localhost:8080/charge",apiContentType:"application/vnd.bank-api.v1+json"}),configuration=new Configuration,Charge=Backbone.Model.extend({url:configuration.apiEndPoint,validate:function(attributes){}}),HalCharges=Backbone.Model.extend({parse:function(response){return response}}),Message=Backbone.Model.extend({message:"",type:""}),Pagination=Backbone.Model.extend({currentPage:1,totalPages:null,next:null,previous:null,currentUrl:null}),AppRouter=Backbone.Router.extend({routes:{"":"homeRoute","add-charge":"addCharge","charge-list":"listCharges"}});$(document).ready(function(){var app_router=new AppRouter;app_router.on("route:addCharge",function(){var v=new AddChargeView;$("#tab-container").html(v.render().el),$("#add-charge-tab").attr("class","active"),$("#charge-list-tab").attr("class","")}),app_router.on("route:listCharges",function(){var v=new ChargeListView;$("#tab-container").html(v.render().el),$("#add-charge-tab").attr("class",""),$("#charge-list-tab").attr("class","active")}),app_router.on("route:homeRoute",function(){var v=new HomeView;$("#tab-container").html(v.render().el),$("#add-charge-tab").attr("class",""),$("#charge-list-tab").attr("class","")}),Backbone.history.start()});var AddChargeView=Backbone.View.extend({events:{"click #add-charge-submit":"performAddCharge"},initialize:function(){this.template=_.template($("#add-charge-template").html())},render:function(){return this.$el.html(this.template()),this},performAddCharge:function(){var description=this.$el.find("#charge-description").val(),amount=this.$el.find("#charge-amount").val(),charge=new Charge({description:description,amount:amount});charge.save({},{success:function(){alert("Charge saved sucessfully"),console.log("Charge saved sucessfully")},error:function(model,response){alert("The charge cannot be saved"),console.log(response.responseText)}})}}),ChargeListView=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"reset add delete change",this.showCharges),this.pagination=new Pagination,this.paginationView=new PaginationView({model:this.pagination}),this.listenTo(this.paginationView,"pageChanged",this.fetchCharges),this.template=_.template($("#charge-list-template").html()),this.fetchCharges()},render:function(){return this.$el.html(this.template()),this},showCharges:function(){this.$el.find("#charge-list-container").empty();var v=null;return this.collection.forEach(function(item,idx){v=new SingleCharge({model:item}),this.$el.find("#charge-list-container").append(v.render().el)},this),this.$el.find("#pagination-container").append(this.paginationView.render().el),this},fetchCharges:function(){var url=this.pagination.get("currentUrl");this.halCharges=(new HalCharges).fetch({type:"GET",contentType:"application/vnd.bank-api.v1+json",url:url,processData:!0,success:_.bind(function(receivedItem,response){this.collection=response._embedded.charge,this.paginationView.setPage(response.page),this.paginationView.setTotalPages(response.page_count),this.paginationView.setNext(response._links.next),this.paginationView.setPrevious(response._links.prev),this.showCharges()},this),error:function(model,response){alert("Charges cannot this loaded at this moment."),console.log(response.responseText)}})}}),HomeView=Backbone.View.extend({initialize:function(){this.template=_.template($("#home-template").html())},render:function(){return this.$el.html(this.template()),this}}),PaginationView=Backbone.View.extend({events:{"click #previous-pagination":"previousPage","click #next-pagination":"nextPage"},initialize:function(){this.listenTo(this.model,"change",this.render),this.template=_.template($("#pagination-template").html()),this.model.set({currentPage:1}),this.model.set({totalPages:1}),this.model.set({next:null}),this.model.set({previous:null}),this.model.set({currentUrl:configuration.apiEndPoint}),this.render()},render:function(){return $(this.el).html(this.template({pagination:this.model.toJSON()})),this},setPage:function(page){this.model.set({currentPage:page})},setTotalPages:function(total){this.model.set({totalPages:total})},setNext:function(next){null!=next&&""!=next.href&&this.model.set({next:next.href})},setPrevious:function(previous){null!=previous&&""!=previous.href&&this.model.set({previous:previous.href})},previousPage:function(){null!=this.model.get("previous")&&this.model.get("currentPage")>1&&(this.model.set({currentPage:this.model.get("currentPage")-1}),this.model.set({currentUrl:this.model.get("previous")}),this.trigger("pageChanged"))},nextPage:function(){null!=this.model.get("next")&&this.model.get("currentPage")<this.model.get("totalPages")&&(this.model.set({currentUrl:this.model.get("next")}),this.model.set({currentPage:this.model.get("currentPage")+1}),this.trigger("pageChanged"))}}),SingleCharge=Backbone.View.extend({className:"charge",initialize:function(){this.template=_.template($("#single-charge-template").html())},render:function(){var html=this.template({charge:this.model}),newElement=$(html);return this.$el.replaceWith(newElement),this.setElement(newElement),this}});